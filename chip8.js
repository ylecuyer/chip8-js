function chip8_init_cpu() {

	register.DT = 0;
	register.ST = 0;

	register.I = 0;

	for (var i = 0; i < 16; i++)
		register.V[i] = 0;

	PC = 0x200;
	SP = 0xF;

	for(var i = 0; i <= 0xF; i++)
		STACK[i] = 0;

}

function chip8_init_keyboard() {

	keyboard = new Array(16);

	for (var i = 0; i < 16; i++)
		keyboard[i] = 0;

	wait_for_keypress =  false;
	register_for_keypress = null;
}

function chip8_init_display() {
	
	//64*32 = 2048
	display = new Array(2048);

	for (var i = 0; i < 64*32; i++)
		display[i] = 0;
}

function chip8_load_rom_into_mem(ROM) {

	chip8_init_mem();

	//Copy ROM inside the memory
	for (var i = 0; i < ROM.length; i += 0x1) {
		MEM[i + 0x200] = ROM[i];
	}
}

function chip8_init_mem() {
	
	//0
	MEM[0x000] = 0xF0; //****
	MEM[0x001] = 0x90; //*  *
	MEM[0x002] = 0x90; //*  *
	MEM[0x003] = 0x90; //*  *
	MEM[0x004] = 0xF0; //****

	//1
	MEM[0x005] = 0x20; //  * 
	MEM[0x006] = 0x60; // ** 
	MEM[0x007] = 0x20; //  * 
	MEM[0x008] = 0x20; //  * 
	MEM[0x009] = 0x70; // ***

	//2
	MEM[0x00A] = 0xF0; //****
	MEM[0x00B] = 0x10; //   *
	MEM[0x00C] = 0xF0; //****
	MEM[0x00D] = 0x80; //*   
	MEM[0x00E] = 0xF0; //****

	//3
	MEM[0x00F] = 0xF0; //****
	MEM[0x010] = 0x10; //   *
	MEM[0x011] = 0xF0; //****
	MEM[0x012] = 0x10; //   *
	MEM[0x013] = 0xF0; //****

	//4
	MEM[0x014] = 0x90; //*  *
	MEM[0x015] = 0x90; //*  *
	MEM[0x016] = 0xF0; //****
	MEM[0x017] = 0x10; //   *
	MEM[0x018] = 0x10; //   *

	//5
	MEM[0x019] = 0xF0; //****
	MEM[0x01A] = 0x80; //*   
	MEM[0x01B] = 0xF0; //****
	MEM[0x01C] = 0x10; //   *
	MEM[0x01D] = 0xF0; //****

	//6
	MEM[0x01E] = 0xF0; //****
	MEM[0x01F] = 0x80; //*   
	MEM[0x020] = 0xF0; //****
	MEM[0x021] = 0x90; //*  *
	MEM[0x022] = 0xF0; //****

	//7
	MEM[0x023] = 0xF0; //****
	MEM[0x024] = 0x10; //   *
	MEM[0x025] = 0x20; //  * 
	MEM[0x026] = 0x40; // *  
	MEM[0x027] = 0x40; // *  

	//8
	MEM[0x028] = 0xF0; //****
	MEM[0x029] = 0x90; //*  *
	MEM[0x02A] = 0xF0; //****
	MEM[0x02B] = 0x90; //*  *
	MEM[0x02C] = 0xF0; //****

	//9
	MEM[0x02D] = 0xF0; //****
	MEM[0x02E] = 0x90; //*  *
	MEM[0x02F] = 0xF0; //****
	MEM[0x030] = 0x10; //   *
	MEM[0x031] = 0xF0; //****

	//A
	MEM[0x032] = 0xF0; //****
	MEM[0x033] = 0x90; //*  *
	MEM[0x034] = 0xF0; //****
	MEM[0x035] = 0x90; //*  *
	MEM[0x036] = 0x90; //*  *

	//B
	MEM[0x037] = 0xE0; //*** 
	MEM[0x038] = 0x90; //*  *
	MEM[0x039] = 0xE0; //*** 
	MEM[0x03A] = 0x90; //*  *
	MEM[0x03B] = 0xE0; //*** 

	//C
	MEM[0x03C] = 0xF0; //****
	MEM[0x03D] = 0x80; //*   
	MEM[0x03E] = 0x80; //*   
	MEM[0x03F] = 0x80; //*   
	MEM[0x040] = 0xF0; //****

	//D 
	MEM[0x041] = 0xE0; //*** 
	MEM[0x042] = 0x90; //*  *
	MEM[0x043] = 0x90; //*  *
	MEM[0x044] = 0x90; //*  *
	MEM[0x045] = 0xE0; //*** 

	//E
	MEM[0x046] = 0xF0; //****
	MEM[0x047] = 0x80; //*   
	MEM[0x048] = 0xF0; //****
	MEM[0x049] = 0x80; //*   
	MEM[0x04A] = 0xF0; //****

	//F
	MEM[0x04B] = 0xF0; //****
	MEM[0x04C] = 0x80; //*   
	MEM[0x04D] = 0xF0; //****
	MEM[0x04E] = 0x80; //*   
	MEM[0x04F] = 0x80; //*   
	
	for (var i = 0x050; i <= 0xFFF; i++)
		MEM[i] = 0x0;
}

function chip8_run() {

	dt_process = setTimeout(decrease_DT, fps60);
	st_process = setTimeout(decrease_ST, fps60);

	process_opcode_ex();
	draw();
}
